<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>避けゲーム</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
    }
    canvas {
      border: 1px solid black;
      background: #f0f0f0;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>

<h1>避けゲーム</h1>
<p>矢印キーで移動 / スペースで開始 / Rキーでリスタート</p>

<canvas id="game" width="400" height="300"></canvas>

<script>
  // ===== 基本設定 =====
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  let gameState = "start"; // start / playing / gameover

  // ===== プレイヤー =====
  const player = {
    x: 180,
    y: 130,
    size: 40,
    speed: 4
  };

  // ===== 敵 =====
  const enemy = {
    x: 100,
    y: 100,
    size: 40,
    vx: 2,
    vy: 2
  };

  // ===== キー入力 =====
  const keys = {};

  document.addEventListener("keydown", (e) => {
    keys[e.key] = true;

    if (gameState === "start" && e.key === " ") {
      startGame();
    }

    if (gameState === "gameover" && e.key === "r") {
      startGame();
    }
  });

  document.addEventListener("keyup", (e) => {
    keys[e.key] = false;
  });

  // ===== ゲーム開始（初期化） =====
  function startGame() {
    player.x = 180;
    player.y = 130;

    enemy.x = 100;
    enemy.y = 100;
    enemy.vx = Math.random() * 4 - 2;
    enemy.vy = Math.random() * 4 - 2;

    gameState = "playing";
  }

  // ===== 当たり判定 =====
  function isHit(a, b) {
    return !(
      a.x + a.size < b.x ||
      a.x > b.x + b.size ||
      a.y + a.size < b.y ||
      a.y > b.y + b.size
    );
  }

  // ===== 更新処理 =====
  function update() {
    if (gameState !== "playing") return;

    // プレイヤー移動
    if (keys["ArrowUp"]) player.y -= player.speed;
    if (keys["ArrowDown"]) player.y += player.speed;
    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;

    // 画面端
    player.x = Math.max(0, Math.min(player.x, canvas.width - player.size));
    player.y = Math.max(0, Math.min(player.y, canvas.height - player.size));

    // 敵移動
    enemy.x += enemy.vx;
    enemy.y += enemy.vy;

    if (enemy.x < 0 || enemy.x + enemy.size > canvas.width) {
      enemy.vx *= -1;
    }
    if (enemy.y < 0 || enemy.y + enemy.size > canvas.height) {
      enemy.vy *= -1;
    }

    if (Math.random() < 0.02) {
      enemy.vx = Math.random() * 4 - 2;
      enemy.vy = Math.random() * 4 - 2;
    }

    // 当たり判定
    if (isHit(player, enemy)) {
      gameState = "gameover";
    }
  }

  // ===== 描画処理 =====
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameState === "start") {
      ctx.fillStyle = "black";
      ctx.font = "28px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("避けゲーム", canvas.width / 2, canvas.height / 2 - 20);
      ctx.font = "16px sans-serif";
      ctx.fillText("スペースキーでスタート", canvas.width / 2, canvas.height / 2 + 20);
      return;
    }

    // プレイヤー
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x, player.y, player.size, player.size);

    // 敵
    ctx.fillStyle = "red";
    ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

    if (gameState === "gameover") {
      ctx.fillStyle = "black";
      ctx.font = "30px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2);
      ctx.font = "16px sans-serif";
      ctx.fillText("Rキーでリスタート", canvas.width / 2, canvas.height / 2 + 30);
    }
  }

  // ===== ゲームループ =====
  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>

</body>
</html>